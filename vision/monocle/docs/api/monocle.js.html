<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: monocle.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: monocle.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*jslint es6*/
/**
 * @author jason a. grafft &lt;jason@grafft.co>
 */
"use strict";
import {adapt} from '@cycle/run/lib/adapt';
import {b, div, img, h2, makeDOMDriver, p, span} from "@cycle/dom";
// import isolate from "@cycle/isolate";
import {run} from "@cycle/run";
import xs from "xstream";

/**
 * Creates xstream driver for *incoming* WebSocket connections
 * @param {string} adr IP address of WebSocket
 * @returns {xs&lt;Stream>}
 */
const wsDriver = (adr) => {
    const ws = new WebSocket(adr);
    const driver = () => {
        const in_ = xs.create({
            start: (listener) => {
                ws.onopen = () => {
                    ws.send(JSON.stringify({req: "find", val: {group: "devices"}}));
                };
                ws.onmessage = (msg) => {
                    const j = JSON.parse(msg.data);
                    listener.next(j);
                };
            },
            stop: () => {
                ws.close();
            }
        });
        return adapt(in_);
    };
    return driver;
};

/**
 * xstream listener that prints input to console
 * @const {xs&lt;Listener>}
 */
const StreamPrinter = {
    next: (v) => console.log(v),
    error: (e) => console.error(e),
    complete: () => console.log("StreamPrinter complete")
};

/**
 * Encapsulates DOM events and display logic for rendering by Cycle.js
 * @param {Object} sources Object containing key-value pairs used by components
 * @returns {Object.&lt;{DOM: DOMSource}>}
 */
const main = (sources) => {
    /**
     * Filters stream for `obj.req === "devices"`
     * @const {xs&lt;Stream>}
     */
    const devices_ = sources.ws
        .filter((x) => x.req === "devices")
        .map((x) => x.res)
        .startWith({devices: [{id: null, dataType: null}]});

    /**
     * Filters stream for `obj.req === "status"`
     * @const {xs&lt;Stream>}
     */
    const status_ = sources.ws
        .filter((x) => x.req === "status")
        .startWith({req: "status", res: "initializing..."});

    /**
     * HTML elements for monocle masthead
     * @const {xs&lt;Stream>}
     */
    const masthead  = div(".masthead", {
            attrs: {style: "background-color: black; color: white; height: 60px; text-align: center;"}
        },
        [
            span(".masthead-element", {attrs: {id: "status", style: "float: left; width: 75px;"}}, "[STATUS]"),
            span(".logo", {attrs: {id: "logo", style: "display: inline-block; margin: 0 auto;"}}, img({attrs: {src: "img/monocle.png", alt: "monocle logo"}})),
            span(".masthead-element", {attrs: {id: "settings", style: "float: right; width: 75px;"}}, "[SET]")
        ]);

    /**
     * Collects click events for `.device` elements
     * @const {xs&lt;Stream>}
     */
    const deviceClicks_ = sources.DOM
        .select(".device")
        .events("click")
        .map((x) => ({id: x.target.id, origin: "devices"}));

    // const preview_= deviceClicks_.;

    /**
     * Collects click events occurring over masthead
     * @const {xs&lt;Stream>}
     */
    const mastheadClicks_ = sources.DOM
        .select(".masthead-element")
        .events("click")
        .map((x) => ({id: x.target.id, origin: "masthead"}));

    /**
     * Collects click events occuring over status element
     * @const {xs&lt;Stream>}
     */
    // const statusClicks_ = sources.DOM
    //     .select(".status")
    //     .events("click")
    //     .map((x) => ({id: x.target.id, origin: "status"}));

    deviceClicks_.addListener(StreamPrinter);
    mastheadClicks_.addListener(StreamPrinter);
    // statusClicks_.addListener(StreamPrinter);

    /** Virtual DOM rendered by Cycle.js
     * @const {DOMSource}
     */
    const vdom_ = xs.combine(devices_, status_)
        .map(([dev, stat]) =>
            div([
                masthead,
                h2("devices"),
                div(".devices-list",
                    Object.keys(dev).map((k) => {
                        return div(`.devices-${k}`,
                            dev[k].map((d) => {
                                return p(".device", {
                                    attrs: {id: d.id, dataType: k}
                                }, [
                                    b(`(${k[0]}) `),
                                    `${d.label}${d.location ? " (" + d.location + ")" : ""}`
                                ])
                            })
                        )
                    })
                ),
                h2("status"),
                div(".status-list", [
                    JSON.stringify(stat)
                ])
            ])
        );

    return {
        DOM: vdom_
    };
};

/**
 * Run `main` and connect it to `driver`
 * @param {Function} main A function that takes `sources` as inputs and outputs `sinks`
 * @param {Object} drivers An object where keys are driver names and values are driver functions
 */
run(main, {
    DOM: makeDOMDriver("#app"),
    ws: wsDriver("ws://localhost:12131")
});

// const localStoreLookup = (id) => localStorage.getItem(id) === null ? false : true;

// const localStoreTransact = (key, obj) => {
//     localStorage.getItem(key) === null ? localStorage.setItem(key, obj) : localStorage.removeItem(key);
// }</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#main">main</a></li><li><a href="global.html#StreamPrinter">StreamPrinter</a></li><li><a href="global.html#wsDriver">wsDriver</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Jul 31 2018 15:19:21 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
